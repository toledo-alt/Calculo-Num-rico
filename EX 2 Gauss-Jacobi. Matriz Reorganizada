import scipy as scp
import numpy as np
from scipy.sparse import csr_matrix, tril, triu, diags, csc_matrix
from scipy.sparse.linalg import spsolve 


def gaussJacobi(matrizA, vetorB, x0, tolerancia, maxit):
    print("k     normres      normrel")
    print("---  ---------     -------------")
    A = csc_matrix(matrizA)
    k = 0
    Erel = 1
    Eres = 1
    L = tril(A, -1)
    D = diags(A.diagonal())
    U = triu(A, 1)
    M = L+U
    x = x0.copy()
    while Erel > tolerancia and Eres > tolerancia and k < maxit:
        x = spsolve(D, vetorB - M @ x)
        Eres = np.linalg.norm(vetorB - A @ x, np.inf)
        Erel = np.linalg.norm(x - x0, np.inf)/np.linalg.norm(x, np.inf)
        x0 = x.copy()
        k = k+1
        print(k,     Eres,        Erel)
    return x, Eres, Erel
#Ordem das equações F1 F2 f2 f3 F3 f5 f1 f4 na matriz
A = np.array([
    [ 1,  0, -1,  0,  0,  0, -np.sqrt(2)/2,  0],    # (1h)
    [ 0,  1,  0,  0,  0,  0, -np.sqrt(2)/2,  0],    # (1v)
    [ 0,  0,  1,  0,  0, -1,  0,  0],               # (3h)
    [ 0,  0,  0,  1,  0,  0,  0,  0],               # (3v)
    [ 0,  0,  0,  0,  1,  0,  0, -1/2],             # (4v)
    [ 0,  0,  0,  0,  0,  1,  0,  np.sqrt(3)/2],    # (4h)
    [ 0,  0,  0,  0,  0,  0,  1, -np.sqrt(3)/2],    # (2h)
    [ 0,  0,  0,  2,  0,  0,  np.sqrt(2),  1]       # (2v)
], float)

matrizEsparsa = csr_matrix(A)

b = np.array([
    0,      # (1h)
    0,      # (1v)
    0,      # (3h)
    10000,  # (3v)
    0,      # (4v)
    0,      # (4h)
    0,      # (2h)
    0       # (2v)
], float)

x0 = np.zeros(8)

gaussJacobi(matrizEsparsa, b, x0, 0.5, 100)
